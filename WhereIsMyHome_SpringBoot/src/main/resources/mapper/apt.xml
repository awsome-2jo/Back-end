<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.myHome.model.mapper.AptMapper">

	<select id="selectApart" parameterType="aptSearchDto" resultType="aptInfoDto">
		select info.aptCode, apartmentName, roadName, jibun, lng, lat, buildYear, dealAmount, cast(area as float) as area
		from houseinfo as info inner join housedeal as deal on info.aptCode = deal.aptCode
		where apartmentName like concat ('%', #{keyword}, '%') 
        and dongCode like concat(#{regcode}, '%')
        and cast(replace(dealAmount, ',', '') as unsigned) &gt;= #{mindeal}
        and cast(replace(dealAmount, ',', '') as unsigned) &lt;= #{maxdeal}
        and area &gt;= #{minarea}
        and area &lt;= #{maxarea}
        and dealYear &gt;= 2020
		group by aptCode limit 10 offset #{start}
	</select>
	
	<select id="countApart" parameterType="aptSearchDto" resultType="aptInfoDto">
		select dealAmount
		from houseinfo as info inner join housedeal as deal on info.aptCode = deal.aptCode
		where apartmentName like concat ('%', #{keyword}, '%') 
        and dongCode like concat(#{regcode}, '%')
        and dealYear &gt;= 2020;
	</select>
	
	<select id="selectApartByAptCode" parameterType="String" resultType="aptInfoDto">
		select buildYear, roadName, jibun, apartmentName, lng, lat
		from houseinfo
		where aptCode = #{aptCode};
	</select>
	
	<select id="selectApartDetail" parameterType="String" resultType="aptDealDto">
		select no, dealAmount, dealYear, dealMonth, dealDay, area, floor, cancelDealType
		from housedeal
		where aptCode = #{aptCode}
	</select> 
	
	<select id="selectSido" resultType="sidoGugunCodeDto">
		select left(code, 2)code, name
		from sidocode
		order by code;
	</select>
	
	<select id="selectGugun" parameterType="string" resultType="sidoGugunCodeDto">
		select left(code, 5)code, name
		from guguncode
		where left(code, 2) = #{code}
		and name is not null
		order by code
	</select>
	
	<select id="selectDong" parameterType="string" resultType="sidoGugunCodeDto">
		select distinct code, name
		from dongcode
		where left(code, 5) = #{code}
		and name is not null
		order by code;
	</select>
	
</mapper>